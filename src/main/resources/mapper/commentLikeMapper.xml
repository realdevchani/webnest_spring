<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.webnest.mapper.CommentLikeMapper">


    <select id="selectByPostIdcount" parameterType="Long" resultType="_int" >
        SELECT COUNT(COMMENT_ID)
        FROM TBL_COMMENT_LIKE
        WHERE COMMENT_ID= #{commentId}
    </select>

    <!-- 좋아요 추가 (DTO 파라미터) -->
    <insert id="insert" parameterType="CommentLikeDTO">
        <selectKey keyProperty="id" order="BEFORE" resultType="Long">
            SELECT SEQ_COMMENT_LIKE.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO TBL_COMMENT_LIKE (ID, USER_ID, COMMENT_ID)
        VALUES (#{id}, #{userId}, #{commentId})
    </insert>

    <!-- 좋아요 삭제 (id로) -->
    <delete id="delete" parameterType="Long">
        DELETE FROM TBL_COMMENT_LIKE
        WHERE ID = #{id}
    </delete>

    <!-- 좋아요 삭제 (VO로) -->
    <delete id="deleteByUserAndComment" parameterType="CommentLikeVO">
        DELETE FROM TBL_COMMENT_LIKE
        WHERE USER_ID = #{userId}
        AND COMMENT_ID = #{commentId} AND ID = #{id}
    </delete>

    <!-- 댓글 ID로 댓글 좋아요들 삭제 -->
    <delete id="deleteByCommentId" parameterType="Long">
        DELETE FROM TBL_COMMENT_LIKE
        WHERE COMMENT_ID = #{commentId}
    </delete>







    <!-- 특정 댓글에 로그인 유저가 좋아요 눌렀는지 -->
    <select id="isLiked" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM TBL_COMMENT_LIKE
        WHERE COMMENT_ID = #{commentId}
        AND USER_ID = #{userId}
    </select>

    <!-- 좋아요 추가 -->
    <insert id="insertLike" parameterType="map">
        INSERT INTO TBL_COMMENT_LIKE (ID, USER_ID, COMMENT_ID)
        VALUES (SEQ_COMMENT_LIKE.NEXTVAL, #{userId}, #{commentId})
    </insert>

    <!-- 좋아요 삭제 -->
    <delete id="deleteLike" parameterType="map">
        DELETE FROM TBL_COMMENT_LIKE
        WHERE COMMENT_ID = #{commentId}
        AND USER_ID = #{userId}
    </delete>

    <!-- 좋아요 개수 조회 -->
    <select id="countLike" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM TBL_COMMENT_LIKE
        WHERE COMMENT_ID = #{commentId}
    </select>

</mapper>